import preact from 'preact';
import { connect } from 'preact-redux';

function PathGrid({width, height, path, scale}) {
    width = width || 500;
    height = height || 500;
    scale = scale ? (width / 500) + ',' + (height / 500) : 1;
    return (
        <svg width={width +"px"} height={height+ "px"}
             viewBox={"0 0 " + width + " " + height}>
          <path style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d={path} vector-effect="non-scaling-stroke" transform={"scale(" + scale + ")"}/>
        </svg>
    );
}



const map_state_to_props = (state) => {
    return {
        grid: state.grid,
        width: state.zoom ? state.zoom.width : null,
        height: state.zoom ? state.zoom.height : null
    };
};

function path(name, width, height) {
    var lines = [];
    switch(name) {
        case 'Golden Ratio':
            var golden_ratio = 1.618034;
            var w = width / golden_ratio;
            var h = height / golden_ratio;
            lines.push('M'+w+',0L'+w+','+height);
            lines.push('M'+(width-w)+',0L'+(width-w)+','+height);
            lines.push('M0,'+h+'L'+width+','+h);
            lines.push('M0,'+(height-h)+'L'+width+','+(height-h));
            break;
        case 'Diagonals':
            //lines.push('M0,0L'+width+','+height);
            lines.push('M0,'+height+'L'+width+',0');
            var a = {
                x: 0,
                y: -height
            };
            var b = {
                x: width,
                y: 0
            };
            var p = intersection(a, b, {x: width, y: -height});
            console.log({height,width});
            console.log(p);
            lines.push('M' + p.x + ',' + p.y + 'L' + width + ',' + height);
            //lines.push('M0,0L'+(width-w)+','+h);
            //lines.push('M'+w+','+(height-h)+'L'+width+','+height);
    }
    return lines.join('');
}

function intersection(a, b, p) {
    var x1 = a.x;
    var y1 = a.y;
    var x2 = p.x;
    var y2 = p.y;
    var x3 = b.x;
    var y3 = b.y;
    var m = (y3 - y1) / (x3 - x1);
    var y = ((m * m * y2) + (x3 / m) + y1 - (m * x1)) / (1 + m*m);
    var x = (m*y2)+(x2/(m*m)) - (m * y);
    return {x,y};
}

function Grid({grid, width, height}) {
    if (grid.path) {
        return <PathGrid width={width} height={height}
                         scale={true} {...grid}/>;
    } else {
        width = width || 500;
        height = height || (500 / (4/3));
        return <PathGrid width={width} height={height}
                         scale={false}
                         path={path(grid.name, width, height)}/>;
    }
}

export default connect(map_state_to_props)(Grid);


export const grids = [
    {
        name: 'Thirds',
        path: 'm 499.37208,333.33288 -499.2156234,0 m 499.2156234,-166.6658 -499.2156234,0 M 334.04967,0 l 0,499.99999 M 167.10372,0 l 0,499.99999 M 0.57728577,0.99601 l 498.84507423,0 0,498.00798 -498.84507423,0 z'
    },
    {
        name: 'Golden Ratio'
    },
    {
        name: 'Diagonals'
    },
    {
        name: 'Symatrical',
        path: 'm 499.41496,249.99999 -499.3948415,0 M 250.49925,1.1007397e-5 250.49925,500 M 0.49897745,0.99602101 l 498.96239255,0 0,498.00797899 -498.96239255,0 z'
    },
    {
        name: 'Horizontal',
        path: 'M 250.51809,1.1007397e-5 250.51809,500 M 0.99602399,0.99602101 l 498.00796601,0 0,498.00797899 -498.00796601,0 z'
    },
    {
        name: 'Spiral 1',
        path: 'M 309.00562,0.36080453 A 190.63357,308.37783 0 0 1 499.6392,308.73863 M 0.36080453,499.6392 A 308.64482,499.27839 0 0 1 309.00562,0.36080453 M 499.57111,308.73863 A 118.01126,190.90057 0 0 1 381.55985,499.6392 m 0,-0.002 A 72.622311,117.47727 0 0 1 308.93754,382.16009 m 0,0.002 a 45.388944,73.423293 0 0 1 45.38895,-73.4233 m 0,0 a 27.233367,44.053976 0 0 1 27.23336,44.05398 m 0,0 a 18.155578,29.369317 0 0 1 -18.15557,29.36932 m 0,0 a 9.077789,14.684659 0 0 1 -9.07779,-14.68466 M 0.36080453,0.36080453 l 308.64481547,0 0,499.27839547 -308.64481547,0 z m 308.64481547,0 190.63358,0 0,308.37782547 -190.63358,0 z m 72.5372,308.47877547 118.09636,0 0,190.69864 -118.09636,0 z m -72.60528,72.94606 72.62231,0 0,117.85356 -72.62231,0 z m 0,-73.04701 45.38895,0 0,73.4233 -45.38895,0 z m 45.38895,0 27.23336,0 0,44.05398 -27.23336,0 z m 9.07779,44.16412 18.15557,0 0,29.2555 -18.15557,0 z m -9.07779,14.57452 9.07779,0 0,14.68466 -9.07779,0 z m 0,-14.68466 9.07779,0 0,14.68466 -9.07779,0 z'
    },
    {
        name: 'Spiral 2',
        path: 'M 499.6392,309.00562 A 308.37783,190.63357 0 0 1 191.26137,499.6392 M 0.36080453,0.36080453 A 499.27839,308.64482 0 0 1 499.6392,309.00562 M 191.26137,499.57111 A 190.90057,118.01126 0 0 1 0.36080453,381.55985 m 0.002,0 A 117.47727,72.622311 0 0 1 117.83991,308.93754 m -0.002,0 a 73.423293,45.388944 0 0 1 73.4233,45.38895 m 0,0 a 44.053976,27.233367 0 0 1 -44.05398,27.23336 m 0,0 a 29.369317,18.155578 0 0 1 -29.36932,-18.15557 m 0,0 a 14.684659,9.077789 0 0 1 14.68466,-9.07779 M 499.6392,0.36080453 l 0,308.64481547 -499.27839547,0 0,-308.64481547 z m 0,308.64481547 0,190.63358 -308.37783,0 0,-190.63358 z m -308.47878,72.5372 0,118.09636 -190.69863547,0 0,-118.09636 z m -72.94606,-72.60528 0,72.62231 -117.85355547,0 0,-72.62231 z m 73.04701,0 0,45.38895 -73.4233,0 0,-45.38895 z m 0,45.38895 0,27.23336 -44.05398,0 0,-27.23336 z m -44.16412,9.07779 0,18.15557 -29.2555,0 0,-18.15557 z m -14.57452,-9.07779 0,9.07779 -14.68466,0 0,-9.07779 z m 14.68466,0 0,9.07779 -14.68466,0 0,-9.07779 z'
    },
    {
        name: 'Spiral 3',
        path: 'M 190.99438,499.6392 A 190.63357,308.37783 0 0 1 0.36080453,191.26137 M 499.6392,0.36080453 A 308.64482,499.27839 0 0 1 190.99438,499.6392 M 0.42889453,191.26137 A 118.01126,190.90057 0 0 1 118.44015,0.36080453 m 0,0.002 A 72.622311,117.47727 0 0 1 191.06246,117.83991 m 0,-0.002 a 45.388944,73.423293 0 0 1 -45.38895,73.4233 m 0,0 a 27.233367,44.053976 0 0 1 -27.23336,-44.05398 m 0,0 a 18.155578,29.369317 0 0 1 18.15557,-29.36932 m 0,0 a 9.077789,14.684659 0 0 1 9.07779,14.68466 m 353.96569,367.11663 -308.64482,0 0,-499.27839547 308.64482,0 z m -308.64482,0 -190.63357547,0 0,-308.37783 190.63357547,0 z m -72.5372,-308.47878 -118.09635547,0 0,-190.69863547 118.09635547,0 z m 72.60528,-72.94606 -72.62231,0 0,-117.85355547 72.62231,0 z m 0,73.04701 -45.38895,0 0,-73.4233 45.38895,0 z m -45.38895,0 -27.23336,0 0,-44.05398 27.23336,0 z m -9.07779,-44.16412 -18.15557,0 0,-29.2555 18.15557,0 z m 9.07779,-14.57452 -9.07779,0 0,-14.68466 9.07779,0 z m 0,14.68466 -9.07779,0 0,-14.68466 9.07779,0 z'
    },
    {
        name: 'Spiral 4',
        path: 'M 0.36080453,190.99438 A 308.37783,190.63357 0 0 1 308.73863,0.36080453 M 499.6392,499.6392 A 499.27839,308.64482 0 0 1 0.36080453,190.99438 M 308.73863,0.42889453 A 190.90057,118.01126 0 0 1 499.6392,118.44015 m -0.002,0 a 117.47727,72.622311 0 0 1 -117.47711,72.62231 m 0.002,0 a 73.423293,45.388944 0 0 1 -73.4233,-45.38895 m 0,0 a 44.053976,27.233367 0 0 1 44.05398,-27.23336 m 0,0 a 29.369317,18.155578 0 0 1 29.36932,18.15557 m 0,0 a 14.684659,9.077789 0 0 1 -14.68466,9.07779 M 0.36080453,499.6392 l 0,-308.64482 499.27839547,0 0,308.64482 z m 0,-308.64482 0,-190.63357547 308.37782547,0 0,190.63357547 z m 308.47877547,-72.5372 0,-118.09635547 190.69864,0 0,118.09635547 z m 72.94606,72.60528 0,-72.62231 117.85356,0 0,72.62231 z m -73.04701,0 0,-45.38895 73.4233,0 0,45.38895 z m 0,-45.38895 0,-27.23336 44.05398,0 0,27.23336 z m 44.16412,-9.07779 0,-18.15557 29.2555,0 0,18.15557 z m 14.57452,9.07779 0,-9.07779 14.68466,0 0,9.07779 z m -14.68466,0 0,-9.07779 14.68466,0 0,9.07779 z'
    }
];
